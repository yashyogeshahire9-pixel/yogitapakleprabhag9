<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>सटाणा नगरपालिका निवडणूक 2025</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <style>
    *, *::before, *::after {margin:0;padding:0;box-sizing:border-box;}
    :root {
      --primary: #0d47a1;
      --primary-dark: #08306b;
      --accent: #ff6f00;
      --success: #25d366;
      --danger: #e53935;
      --light: #f8fafc;
      --gray: #e2e8f0;
      --text: #1a202c;
      --text-light: #718096;
    }
    body {
      font-family: 'Roboto', 'Noto Sans Devanagari', sans-serif;
      background: linear-gradient(135deg, #e6f2ff 0%, #f0f4ff 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
      line-height: 1.6;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 560px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 24px 32px;
      text-align: center;
      position: relative;
    }
    .header::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><rect fill="%23ff6f00" width="100" height="4"/><rect fill="%23ffffff" y="8" width="100" height="4"/><rect fill="%2300a651" y="16" width="100" height="4"/></svg>') center/cover;
      opacity: 0.15;
    }
    .logo-img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 4px solid rgba(255,255,255,0.3);
      object-fit: cover;
      margin-bottom: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .header h1 {
      font-size: 22px;
      font-weight: 600;
      margin: 8px 0;
    }
    .header .subtitle {
      font-size: 16px;
      opacity: 0.95;
      font-weight: 400;
    }
    .header .marathi {
      font-family: 'Noto Sans Devanagari', sans-serif;
      font-size: 18px;
      margin-top: 6px;
      font-weight: 500;
    }

    /* Body */
    .body { padding: 32px; }

    .form-group { margin-bottom: 20px; }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 13px;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    input {
      width: 100%;
      padding: 13px 16px;
      border: 2px solid var(--gray);
      border-radius: 8px;
      font-size: 15px;
      background: white;
      transition: all 0.2s ease;
    }
    input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(13, 71, 161, 0.15);
    }

    /* Search */
    .search-container { position: relative; }
    #suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 2px solid var(--gray);
      border-top: none;
      max-height: 280px;
      overflow-y: auto;
      z-index: 10;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      display: none;
      border-radius: 0 0 8px 8px;
    }
    .suggestion-item {
      padding: 14px 16px;
      border-bottom: 1px solid #edf2f7;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .suggestion-item:hover { background: #f8fafc; }
    .suggestion-item strong { color: var(--text); }
    .suggestion-item small { color: var(--text-light); font-size: 12px; }
    .suggestion-item.loading { cursor: default; color: var(--text-light); }

    /* Result */
    #result {
      display: none;
      margin-top: 24px;
      padding: 20px;
      background: #f8fafc;
      border: 1px solid var(--gray);
      border-radius: 12px;
    }
    .voter-details h3 {
      margin-bottom: 16px;
      color: var(--primary);
      font-size: 18px;
      font-weight: 600;
      border-bottom: 2px solid var(--accent);
      padding-bottom: 6px;
      display: inline-block;
    }
    .details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .detail-item {
      background: white;
      padding: 12px;
      border: 1px solid var(--gray);
      border-radius: 8px;
    }
    .detail-item .label {
      display: block;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--primary);
      letter-spacing: 0.5px;
    }
    .detail-item .value {
      margin-top: 2px;
      font-weight: 500;
      color: var(--text);
      font-size: 14px;
    }

    /* Share Button */
    #shareBtn {
      background: var(--success);
      color: white;
      margin-top: 16px;
      padding: 12px 24px;
      font-size: 14px;
      border-radius: 8px;
      display: inline-block;
      width: auto;
    }

    /* Modal */
    #whatsappModal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 100;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }
    #whatsappModal .modal-content {
      background: white;
      padding: 24px;
      width: 100%;
      max-width: 400px;
      border-radius: 16px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.2);
    }

    /* Messages */
    .message {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
      border-left: 4px solid;
      animation: slideIn 0.3s ease;
    }
    .message.success { background: #e8f5e9; border-left-color: #43a047; color: #2e7d32; }
    .message.error { background: #ffebee; border-left-color: var(--danger); color: #c62828; }
    @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    .footer {
      text-align: center;
      margin-top: 32px;
      color: #1e293b;
      font-weight: 600;
      font-size: 13px;
    }

    @media (max-width: 480px) {
      .details-grid { grid-template-columns: 1fr; }
      .header { padding: 20px 16px; }
      .body { padding: 24px 20px; }
    }
  </style>
</head>
<body>

<div class="container">
  <!-- HEADER -->
  <div class="header">
    <img src="/mahraj.jpeg" alt="Yashwantrao Chavan" class="logo-img">
    <h1>सटाणा नगरपालिका निवडणूक 2025</h1>
    <div class="subtitle"><b>By : यश कॉम्प्युटर्स (Coding & MS-CIT Classes)</b></div>
    <div class="marathi">मतदार शोध ॲप प्रभाग क्र. 8</div>
    <div class="marathi"><b>अॅड. यशवंत हिरामण पाटील (निशाणी-घड्याळ)</b></div>
  </div>

  <div class="body">

    <!-- SEARCH SECTION (directly visible) -->
    <div id="searchSection">
      <h2 style="margin:0 0 20px; font-size:19px; color:var(--text); text-align:center;">
        मतदार शोधा / Search Voter
      </h2>

      <div class="form-group">
        <label for="searchInput">मतदाराचे नाव टाइप करा</label>
        <div class="search-container">
          <input type="text" id="searchInput" placeholder="नाव टाइप करा – किमान २ अक्षरे" autocomplete="off"/>
          <div id="suggestions"></div>
        </div>
      </div>

      <div id="result"></div>
    </div>

  </div>

  <!-- FOOTER -->
  <div class="footer">
    <p>Local Voter Search System</p>
    <p>© 2025 Yash Computers Coding Classes | MS-CIT Centre</p>
  </div>
</div>

<!-- WhatsApp Modal -->
<div id="whatsappModal">
  <div class="modal-content">
    <h3 style="margin:0 0 16px; font-size:18px; color:var(--primary);">WhatsApp वर पाठवा</h3>
    <input type="text" id="whatsappNumber" placeholder="+919876543210" style="width:100%; padding:13px 16px; border:2px solid var(--gray); border-radius:8px; font-size:15px; margin-bottom:16px;"/>
    <div style="display:flex; gap:8px;">
      <button id="sendWhatsapp" style="flex:1; background:var(--success); color:white; border:none; padding:13px; font-weight:600; cursor:pointer; border-radius:8px;">पाठवा</button>
      <button id="cancelWhatsapp" style="flex:1; background:#e0e0e0; color:#212121; border:none; padding:13px; cursor:pointer; border-radius:8px;">रद्द करा</button>
    </div>
  </div>
</div>

<script>
  $(function () {
    const CSV_HEADERS = [
      "अ.नं.", "नाव (मराठी)", "English Name","मतदान केंद्र", "उमेदवार", "निशाणी", "आवाहन"
    ];

    function esc(s) { return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }

    function msg(text, type = 'error') {
      const el = $(`<div class="message ${type}">${esc(text)}</div>`);
      $('.body').prepend(el);
      setTimeout(() => el.fadeOut(() => el.remove()), 5000);
    }

    let timeout;
    $('#searchInput').on('input', function () {
      clearTimeout(timeout);
      const q = this.value.trim();
      const $s = $('#suggestions');

      if (q.length < 2) {
        $s.hide();
        $('#result').hide();
        return;
      }

      $s.html('<div class="suggestion-item loading">शोधत आहे...</div>').show();

      timeout = setTimeout(() => {
        $.ajax({
          url: '/search',          // Change this if your endpoint is different
          method: 'GET',
          data: { q: q },
          dataType: 'json'
        })
        .done(data => {
          $s.empty();
          if (!data || data.length === 0) {
            $s.append('<div class="suggestion-item">कोणतेही निकाल सापडले नाहीत</div>').show();
            $('#result').hide();
            return;
          }

          data.forEach(v => {
            const item = $(`
              <div class="suggestion-item">
                <div><strong>${esc(v.englishName || 'N/A')}</strong></div>
                <small>${esc(v.marathiName || 'N/A')}</small>
              </div>
            `);
            item.on('click', () => {
              $('#searchInput').val(v.englishName || v.marathiName);
              $s.hide();
              showResult(v);
            });
            $s.append(item);
          });
          $s.show();
        })
        .fail(() => {
          $s.html('<div class="suggestion-item">शोध अयशस्वी झाला</div>');
        });
      }, 300);
    });

    // Hide suggestions when clicking outside
    $(document).on('click', e => {
      if (!$(e.target).closest('.search-container').length) $('#suggestions').hide();
    });

    function showResult(v) {
      const fieldMap = {
        serial: "अ.नं.",
        marathiName: "नाव (मराठी)",
        englishName: "English Name",
        polling: "मतदान केंद्र",
        voteFor: "उमेदवार",
        vote: "निशाणी",
        message: "आवाहन"
      };

      const gridItems = CSV_HEADERS.map(col => {
        const backendKey = Object.keys(fieldMap).find(k => fieldMap[k] === col);
        const val = backendKey && v[backendKey] ? String(v[backendKey]).trim() : 'N/A';
        return `
          <div class="detail-item">
            <span class="label">${esc(col)}:</span>
            <span class="value">${esc(val)}</span>
          </div>`;
      }).join('');

      const html = `
        <div class="voter-details">
          <h3>मतदाराची माहिती</h3>
          <div class="details-grid">${gridItems}</div>
        </div>
        <div style="margin-top:20px; text-align:center;">
          <button id="shareBtn">WhatsApp वर शेअर करा</button>
        </div>`;

      $('#result').html(html).slideDown(300);

      $('#shareBtn').off('click').on('click', () => {
        $('#whatsappModal').fadeIn(200);
        $('#whatsappNumber').val('').focus();
      });
    }

    // WhatsApp Share
    $('#cancelWhatsapp').on('click', () => $('#whatsappModal').fadeOut(200));

    $('#sendWhatsapp').on('click', function () {
      const raw = $('#whatsappNumber').val().trim();
      const number = raw.replace(/[^\d+]/g, '');
      if (!number || !/^(\+?\d{10,15})$/.test(number)) {
        return msg('कृपया वैध मोबाईल नंबर टाका (+919876543210)', 'error');
      }

      const lines = ['*मतदार माहिती / Voter Info*'];
      CSV_HEADERS.forEach(col => {
        const $label = $(`#result .detail-item .label:contains("${col}")`);
        const value = $label.length ? $label.next('.value').text().trim() : 'N/A';
        lines.push(`*${col}:* ${value}`);
        if (col === "मतदान केंद्र") lines.push('');
      });

      const text = encodeURIComponent(lines.join('\n'));
      const waURL = `https://wa.me/${number}?text=${text}`;
      window.open(waURL, '_blank');

      $('#whatsappModal').fadeOut(200);
      msg('WhatsApp उघडत आहे...', 'success');
    });

    // Focus on load
    $('#searchInput').focus();
  });
</script>
</body>
</html>